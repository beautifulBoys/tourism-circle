{"version":3,"sources":["../../src/controller/post.js"],"names":["arr","list","i","length","findOne","id","userId","user","obj","avatar","push","changeList","postingFunc","req","res","headers","userid","type","create","title","body","spot","city","time","content","urls","rate","tagList","starList","commentList","value","update","$inc","postNum","multi","send","code","message","data","sort","result","b","a","console","log","postFunc","pageConfig","num","query","page","start","end","sortString","find","status","skip","limit","list_a","slice","isStared","indexOf","j","userStar","h","comment","url","name","username","userInfo","desc","postTime","formatCSTDate","starFunc","postId","starIndex","statusText","err","docs","splice","filter","item","newstarlist","pinglunFunc","Date","starNum","post","concat","newComment","myPostedFunc","changeMinePostStatusFunc","statusObj","hide","text","show","delete"],"mappings":"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","file":"post.js","sourcesContent":["\r\nimport Post from '../model/post.js';\r\nimport Id from '../model/id.js';\r\nimport User from '../model/user.js';\r\nimport Star from '../model/star.js';\r\nimport Comment from '../model/comment.js';\r\nimport util from '../lib/formDate.js';\r\n\r\n\r\nexport const postingFunc = async (req, res) => {\r\n  let userId = req.headers.userid;\r\n  let obj = await Id.findOne({type: 'postId'});\r\n  try {\r\n    await Post.create({\r\n      title: req.body.title,\r\n      spot: req.body.spot,\r\n      city: req.body.city,\r\n      time: req.body.time,\r\n      content: req.body.content,\r\n      urls: req.body.urls,\r\n      rate: req.body.rate,\r\n      tagList: req.body.tagList,\r\n      starList: [],\r\n      commentList: [],\r\n      userId: req.headers.userid,\r\n      id: obj.value + 1\r\n    });\r\n    await User.update({id: userId}, {$inc: {postNum: 1}}, {multi: false}, () => {});\r\n    res.send({code: 200, message: '分享成功', data: {}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '分享失败', data: err});\r\n  }\r\n\r\n};\r\n\r\nfunction sort (type, list) {\r\n  let result;\r\n  if (type === 'newest') {\r\n    result = list;\r\n  } else if (type === 'hotest') {\r\n    result = list.sort((b, a) => {\r\n      return a.starList.length - b.starList.length;\r\n    });\r\n  } else if (type === 'mostest') {\r\n    result = list.sort((b, a) => {\r\n      return a.commentList.length - b.commentList.length;\r\n    });\r\n  } else console.log('出错了，请检查');\r\n  return result;\r\n}\r\n\r\nasync function changeList (arr) {\r\n  let list = [];\r\n  for (let i = 0; i < arr.length; i++) {\r\n    let user = await User.findOne({id: arr[i].userId});\r\n    let obj = {...arr[i], avatar: user.avatar};\r\n    list.push(obj);\r\n  }\r\n  return list;\r\n}\r\n\r\nexport const postFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let pageConfig = {\r\n    num: req.query.num - 0, // 每页数量\r\n    page: req.query.page - 0 // 当前页数\r\n  };\r\n  let start = pageConfig.page * pageConfig.num;\r\n  let end = start + pageConfig.num;\r\n  console.log(pageConfig);\r\n  let type = req.query.type ? req.query.type : 'newest';\r\n  let sortString = 0;\r\n  // let arr = await Post.find({status: 0}).sort({postTime: -1});\r\n  let arr = [];\r\n  if (type === 'newest') {\r\n    arr = await Post.find({status: 0})\r\n    .skip(start)\r\n    .limit(pageConfig.num)\r\n    .sort({'_id': -1});\r\n  } else {\r\n    let list_a = await Post.find({});\r\n    if (type === 'mostest') {\r\n      list_a = list_a.sort((b, a) => (a.commentList.length - b.commentList.length));\r\n      arr = list_a.slice(start, end);\r\n    } else if (type === 'hotest') {\r\n      list_a = list_a.sort((b, a) => (a.starList.length - b.starList.length));\r\n      arr = list_a.slice(start, end);\r\n    }\r\n  }\r\n\r\n  let list = [];\r\n  for (let i = 0; i < arr.length; i++) {\r\n    let user = await User.findOne({id: arr[i].userId});\r\n    let isStared = (arr[i].starList.indexOf(userId) === -1 ? false : true);\r\n    let starList = [];\r\n    for (let j = 0; j < arr[i].starList.length; j++) {\r\n      let userStar = await User.findOne({id: arr[i].starList[j] - 0});\r\n      starList.push(userStar);\r\n    }\r\n    let commentList = [];\r\n    for (let h = 0; h < arr[i].commentList.length; h++) {\r\n      let user = await User.findOne({id: arr[i].commentList[h].userId});\r\n\r\n      commentList.push({\r\n        comment: arr[i].commentList[h].comment,\r\n        user: {\r\n          url: user.avatar,\r\n          name: user.username\r\n        }\r\n      });\r\n    }\r\n    let obj = {\r\n      id: arr[i].id,\r\n      userId: arr[i].userId - 0,\r\n      userInfo: {\r\n        username: user.username,\r\n        desc: user.desc,\r\n        avatar: user.avatar\r\n      },\r\n      postTime: util.formatCSTDate(arr[i].postTime),\r\n      commentList,\r\n      starList,\r\n      tagList: arr[i].tagList,\r\n      rate: arr[i].rate,\r\n      urls: arr[i].urls,\r\n      content: arr[i].content,\r\n      time: arr[i].time,\r\n      city: arr[i].city,\r\n      spot: arr[i].spot,\r\n      title: arr[i].title,\r\n      avatar: user.avatar,\r\n      isStared\r\n    };\r\n    list.push(obj);\r\n  }\r\n  res.send({code: 200, message: '获取数据成功', data: {list}});\r\n};\r\n\r\n\r\n\r\nexport const starFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let postId = req.body.id - 0;\r\n\r\n  let {starList} = await Post.findOne({id: postId});\r\n  starList = [...starList];\r\n\r\n  let starIndex = starList.indexOf(userId);\r\n  let status = null;\r\n  let statusText = null;\r\n  if (starIndex === -1) {\r\n    starList.push(userId);\r\n    status = 'star';\r\n    statusText = '喜欢成功';\r\n    let {list} = await Star.findOne({id: userId});\r\n    list = [...list, postId];\r\n    await Star.update({id: userId}, {list}, {multi: false}, (err, docs) => {\r\n      if (err) console.log('喜欢分享出错了', err);\r\n    });\r\n  } else {\r\n    starList.splice(starIndex, 1);\r\n    status = 'unstar';\r\n    statusText = '取消喜欢成功';\r\n    let {list} = await Star.findOne({id: userId});\r\n    list = list.filter(item => (item - 0 !== postId));\r\n\r\n    await Star.update({id: userId}, {list}, {multi: false}, (err, docs) => {\r\n      if (err) console.log('喜欢分享出错了', err);\r\n    });\r\n  }\r\n  try {\r\n    await Post.update({id: req.body.id}, {starList}, {multi: false}, () => {});\r\n    let newstarlist = [];\r\n    for (let i = 0; i < starList.length; i++) {\r\n      let user = await User.findOne({id: starList[i] - 0});\r\n      newstarlist.push({\r\n        avatar: user.avatar\r\n      });\r\n    }\r\n    res.send({code: 200, message: statusText, data: {\r\n      status,\r\n      list: newstarlist\r\n    }});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '操作失败', data: err});\r\n  }\r\n\r\n};\r\n\r\n\r\nexport const pinglunFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let postId = req.body.id - 0;\r\n  let value = req.body.value;\r\n\r\n  let comment = {\r\n    comment: {\r\n      time: new Date(),\r\n      starNum: 0,\r\n      content: value\r\n    },\r\n    userId: userId\r\n  };\r\n\r\n  let post = await Post.findOne({id: postId});\r\n  let commentList = post.commentList.concat([]);\r\n  commentList.push(comment);\r\n\r\n  let user = await User.findOne({id: userId});\r\n  let newComment = {\r\n    comment: {\r\n      content: value\r\n    },\r\n    user: {\r\n      url: user.avatar,\r\n      name: user.username\r\n    },\r\n    userInfo: {\r\n      avatar: user.avatar,\r\n      username: user.username\r\n    }\r\n  };\r\n\r\n  let {list} = await Comment.findOne({id: userId});\r\n  if (list.indexOf(postId) === -1) {\r\n    list = [...list, postId];\r\n    await Comment.update({id: userId}, {list}, {multi: false}, () => {});\r\n  }\r\n  try {\r\n    await Post.update({id: postId}, {commentList}, {multi: false}, () => {});\r\n    await Comment.update({id: userId}, {commentList}, {multi: false}, () => {});\r\n    res.send({code: 200, message: '评论成功', data: newComment});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '评论失败，请联系管理员', data: err});\r\n  }\r\n\r\n};\r\nexport const myPostedFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let pageConfig = {\r\n    num: req.body.num - 0, // 每页数量\r\n    page: req.body.page - 0 // 当前页数\r\n  };\r\n  let start = pageConfig.page * pageConfig.num;\r\n  let end = start + pageConfig.num;\r\n  let list = [];\r\n\r\n  try {\r\n\r\n    let arr = await Post.find({userId});\r\n    arr = arr.slice(start, end);\r\n    for (let i = 0; i < arr.length; i++) {\r\n      if (arr[i].status === 2) continue; // 逻辑删除的不做显示\r\n      let user = await User.findOne({id: arr[i].userId});\r\n      let isStared = (arr[i].starList.indexOf(userId) === -1 ? false : true);\r\n      let starList = [];\r\n      for (let j = 0; j < arr[i].starList.length; j++) {\r\n        let user = await User.findOne({id: arr[i].starList[j] - 0});\r\n        starList.push(user);\r\n      }\r\n      let commentList = [];\r\n      for (let h = 0; h < arr[i].commentList.length; h++) {\r\n        let user = await User.findOne({id: arr[i].commentList[h].userId});\r\n\r\n        commentList.push({\r\n          comment: arr[i].commentList[h].comment,\r\n          user: {\r\n            url: user.avatar,\r\n            name: user.username\r\n          }\r\n        });\r\n      }\r\n      let obj = {\r\n        id: arr[i].id,\r\n        userId: arr[i].userId - 0,\r\n        postTime: util.formatCSTDate(arr[i].postTime),\r\n        commentList,\r\n        starList,\r\n        tagList: arr[i].tagList,\r\n        rate: arr[i].rate,\r\n        urls: arr[i].urls,\r\n        content: arr[i].content,\r\n        time: arr[i].time,\r\n        city: arr[i].city,\r\n        spot: arr[i].spot,\r\n        title: arr[i].title,\r\n        avatar: user.avatar,\r\n        isStared,\r\n        status: arr[i].status\r\n      };\r\n      list.push(obj);\r\n    }\r\n    res.send({code: 200, message: '获取我的分享成功', data: {list}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '获取我的分享失败，请联系管理员', data: err});\r\n  }\r\n};\r\n\r\nexport const changeMinePostStatusFunc = async (req, res) => {\r\n  let postId = req.body.id - 0;\r\n  let status = req.body.status;\r\n  let list = [];\r\n  let statusObj = {\r\n    hide: {num: 1, text: '隐藏'},\r\n    show: {num: 0, text: '显示'},\r\n    delete: {num: 2, text: '删除'}\r\n  };\r\n  status = statusObj[status];\r\n  try {\r\n    await Post.update({id: postId}, {status: status.num}, {multi: false}, () => {});\r\n\r\n    res.send({code: 200, message: status.text + '我的分享成功', data: {}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: status.text + '我的分享失败，请联系管理员', data: err});\r\n  }\r\n\r\n};\r\n"]}