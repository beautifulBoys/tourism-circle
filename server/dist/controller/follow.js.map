{"version":3,"sources":["../../src/controller/follow.js"],"names":["toFollowFunc","req","res","userId","headers","userid","toId","body","id","send","code","message","data","findOne","list","indexOf","update","multi","err","toObj","list1","console","log","myFollowingFunc","arr","i","length","user","item","address","join","email","username","desc","postNum","avatar","push","deleteFollowingFunc","deleteId","filter","obj","sex","followsFunc"],"mappings":"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","file":"follow.js","sourcesContent":["import Following from '../model/following.js';\r\nimport User from '../model/user.js';\r\nimport Follow from '../model/follow.js';\r\n\r\nexport const toFollowFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let toId = req.body.id - 0;\r\n  if (userId === toId) {\r\n    res.send({code: 300, message: '不能关注自己', data: {}});\r\n    return;\r\n  }\r\n  try {\r\n    let {list} = await Following.findOne({id: userId});\r\n    if (list.indexOf(toId) !== -1) {\r\n      res.send({code: 300, message: '你已经关注了他（她）', data: {}});\r\n      return;\r\n    }\r\n    // 更新关注用户\r\n    list = [...list, toId];\r\n    await Following.update({id: userId}, {list}, {multi: false}, (err) => {});\r\n\r\n    // 更新被关注用户\r\n    let toObj = await Follow.findOne({id: toId});\r\n    let list1 = [...toObj.list, userId];\r\n    console.log(toObj.list, list1);\r\n    await Follow.update({id: toId}, {list: list1}, {multi: false}, (err) => {});\r\n\r\n    res.send({code: 200, message: '关注成功', data: {}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '关注失败', data: err});\r\n  }\r\n};\r\n\r\nexport const myFollowingFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let arr = [];\r\n  try {\r\n    let {list} = await Following.findOne({id: userId});\r\n    for (let i = 0; i < list.length; i++) {\r\n      let user = await User.findOne({id: list[i] - 0});\r\n      let item = {\r\n        address: user.address.length > 0 ? user.address.join('-') : '',\r\n        email: user.email,\r\n        id: user.id,\r\n        username: user.username,\r\n        desc: user.desc,\r\n        postNum: user.postNum,\r\n        avatar: user.avatar\r\n      };\r\n      arr.push(item);\r\n    }\r\n    res.send({code: 200, message: '获取关注列表成功', data: {list: arr}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '获取关注列表失败', data: err});\r\n  }\r\n};\r\n\r\nexport const deleteFollowingFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let deleteId = req.body.id - 0;\r\n  let arr = [];\r\n  try {\r\n    let {list} = await Following.findOne({id: userId});\r\n    list = [...list].filter(item => (item - 0 !== deleteId));\r\n    await Following.update({id: userId}, {list}, {multi: false}, (err) => {});\r\n    // 去除粉丝列表的\r\n    let obj = await Follow.findOne({id: deleteId});\r\n    let list1 = [...obj.list].filter(item => (item - 0 !== userId));\r\n    await Follow.update({id: deleteId}, {list: list1}, {multi: false}, (err) => {});\r\n\r\n    for (let i = 0; i < list.length; i++) {\r\n      let user = await User.findOne({id: list[i] - 0});\r\n      let item = {\r\n        address: user.address.length > 0 ? user.address.join('-') : '未设置',\r\n        email: user.email || '未设置',\r\n        id: user.id,\r\n        username: user.username,\r\n        desc: user.desc || '未设置',\r\n        postNum: user.postNum\r\n      };\r\n      if (user.sex === 1) item.sex = '女孩';\r\n      else if (user.sex === 2) item.sex = '男孩';\r\n      else item.sex = '未设置';\r\n      arr.push(item);\r\n    }\r\n    res.send({code: 200, message: '取消关注成功', data: {list: arr}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '取消关注失败', data: err});\r\n  }\r\n};\r\n\r\n\r\n\r\nexport const followsFunc = async (req, res) => {\r\n  let userId = req.headers.userid - 0;\r\n  let arr = [];\r\n  try {\r\n    let {list} = await Follow.findOne({id: userId});\r\n    for (let i = 0; i < list.length; i++) {\r\n      let user = await User.findOne({id: list[i] - 0});\r\n      let item = {\r\n        address: user.address.length > 0 ? user.address.join('-') : '',\r\n        email: user.email,\r\n        id: user.id,\r\n        username: user.username,\r\n        desc: user.desc,\r\n        postNum: user.postNum,\r\n        avatar: user.avatar,\r\n        sex: user.sex\r\n      };\r\n      arr.push(item);\r\n    }\r\n    res.send({code: 200, message: '获取粉丝列表成功', data: {list: arr}});\r\n  } catch (err) {\r\n    res.send({code: 300, message: '获取粉丝列表失败', data: err});\r\n  }\r\n};"]}