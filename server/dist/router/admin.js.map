{"version":3,"sources":["../../src/router/admin.js"],"names":["router","Router","use","req","res","next","path","findOne","result","update","$inc","num","multi","create","err","docs","console","log","post","get"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AAOA;;AASA;;AAIA;;AAOA;;AAMA;;AAOA;;AAKA;;AAIA;;AAIA;;;;AAOA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,GAAP;AAAA,sFAAW,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AACLC,gBADK,GACEH,IAAIG,IADN;AAAA;AAAA,mBAEU,cAAIC,OAAJ,CAAY,EAACD,UAAD,EAAZ,CAFV;;AAAA;AAELE,kBAFK;;AAAA,iBAGLA,MAHK;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAGS,cAAIC,MAAJ,CAAW,EAACH,UAAD,EAAX,EAAmB,EAACI,MAAM,EAACC,KAAK,EAAN,EAAP,EAAnB,EAAsC,EAACC,OAAO,KAAR,EAAtC,EAAsD,YAAM,CAAE,CAA9D,CAHT;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,mBAKD,cAAIC,MAAJ,CAAW,EAACP,UAAD,EAAX,EAAmB,UAACQ,GAAD,EAAMC,IAAN,EAAe;AACtC,kBAAID,GAAJ,EAASE,QAAQC,GAAR,CAAY,iBAAZ,EAA+BH,GAA/B;AACV,aAFK,CALC;;AAAA;AAST,iDAAmBX,GAAnB,EAAwBC,GAAxB,EAA6BC,IAA7B;;AATS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAX;;AAAA;AAAA;AAAA;AAAA;;AAYAL,OAAOkB,IAAP,CAAY,QAAZ;AACAlB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOmB,GAAP,CAAW,OAAX;;AAEAnB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOkB,IAAP,CAAY,iBAAZ;AACAlB,OAAOkB,IAAP,CAAY,iBAAZ;AACAlB,OAAOkB,IAAP,CAAY,cAAZ;AACAlB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOkB,IAAP,CAAY,YAAZ;AACAlB,OAAOkB,IAAP,CAAY,cAAZ;AACAlB,OAAOkB,IAAP,CAAY,iBAAZ;AACAlB,OAAOkB,IAAP,CAAY,gBAAZ;AACAlB,OAAOkB,IAAP,CAAY,eAAZ;AACAlB,OAAOkB,IAAP,CAAY,cAAZ;AACAlB,OAAOkB,IAAP,CAAY,OAAZ;AACAlB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOkB,IAAP,CAAY,WAAZ;AACAlB,OAAOkB,IAAP,CAAY,eAAZ;AACAlB,OAAOkB,IAAP,CAAY,WAAZ;AACAlB,OAAOkB,IAAP,CAAY,cAAZ;AACAlB,OAAOkB,IAAP,CAAY,kBAAZ;AACAlB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOkB,IAAP,CAAY,WAAZ;AACAlB,OAAOkB,IAAP,CAAY,SAAZ;AACAlB,OAAOkB,IAAP,CAAY,aAAZ;AACAlB,OAAOkB,IAAP,CAAY,uBAAZ;AACAlB,OAAOkB,IAAP,CAAY,UAAZ;AACAlB,OAAOkB,IAAP,CAAY,cAAZ;AACAlB,OAAOkB,IAAP,CAAY,MAAZ;AACAlB,OAAOkB,IAAP,CAAY,MAAZ;AACAlB,OAAOmB,GAAP,CAAW,WAAX;;kBAEenB,M","file":"admin.js","sourcesContent":["import express from 'express';\r\n\r\nimport formidable from 'formidable';\r\nimport util from 'util';\r\nimport Image from '../model/image.js';\r\nimport Id from '../model/id.js';\r\nimport User from '../model/user.js';\r\nimport Api from '../model/api.js';\r\nimport cityData from '../data/city.js';\r\n\r\nimport {\r\n  loginFunc,\r\n  userInfoUpdateFunc,\r\n  getUserInfoFunc,\r\n  getAllUserFunc\r\n} from '../controller/user.js';\r\n\r\nimport {\r\n  postingFunc,\r\n  postFunc,\r\n  starFunc,\r\n  pinglunFunc,\r\n  myPostedFunc,\r\n  changeMinePostStatusFunc\r\n} from '../controller/post.js';\r\n\r\nimport {\r\n  galleryFunc,\r\n  galleryDeleteFunc\r\n} from '../controller/gallery.js';\r\nimport {\r\n  webMailSendFunc,\r\n  messageBoxListFunc,\r\n  ignoreMessageFunc,\r\n  sendWebMailFunc\r\n} from '../controller/message.js';\r\n\r\nimport {\r\n  deleteFriendFunc,\r\n  addFriendFunc,\r\n  myFriendFunc,\r\n  friendHandleFunc\r\n} from '../controller/friend.js';\r\nimport {\r\n  toFollowFunc,\r\n  myFollowingFunc,\r\n  deleteFollowingFunc,\r\n  followsFunc\r\n} from '../controller/follow.js';\r\n\r\nimport {\r\n  myStarFunc,\r\n  myCommentsFunc\r\n} from '../controller/common.js';\r\n\r\nimport {\r\n  rankingFunc\r\n} from '../controller/ranking.js';\r\n\r\nimport {\r\n  apiFunc\r\n} from '../controller/api.js';\r\n\r\nimport {\r\n  getCityDataFunc,\r\n  authenticationFunc,\r\n  mapFunc,\r\n  downloadFunc\r\n} from '../controller/admin_other.js';\r\n\r\nconst router = express.Router();\r\n\r\nrouter.use(async (req, res, next) => {\r\n  let path = req.path;\r\n  let result = await Api.findOne({path});\r\n  if (result) await Api.update({path}, {$inc: {num: 12}}, {multi: false}, () => {});\r\n  else {\r\n    await Api.create({path}, (err, docs) => {\r\n      if (err) console.log('create user 出错了', err);\r\n    });\r\n  }\r\n  authenticationFunc(req, res, next);\r\n});\r\n\r\nrouter.post('/login', loginFunc);\r\nrouter.post('/posting', postingFunc);\r\nrouter.get('/post', postFunc);\r\n\r\nrouter.post('/gallery', galleryFunc);\r\nrouter.post('/gallery-delete', galleryDeleteFunc);\r\nrouter.post('/updateUserInfo', userInfoUpdateFunc);\r\nrouter.post('/getUserInfo', getUserInfoFunc);\r\nrouter.post('/allUser', getAllUserFunc);\r\nrouter.post('/addFriend', addFriendFunc);\r\nrouter.post('/sendWebMail', sendWebMailFunc);\r\nrouter.post('/messageBoxList', messageBoxListFunc);\r\nrouter.post('/ignoreMessage', ignoreMessageFunc);\r\nrouter.post('/friendHandle', friendHandleFunc);\r\nrouter.post('/webMailSend', webMailSendFunc);\r\nrouter.post('/star', starFunc);\r\nrouter.post('/pinglun', pinglunFunc);\r\nrouter.post('/myFriend', myFriendFunc);\r\nrouter.post('/deleteFriend', deleteFriendFunc);\r\nrouter.post('/toFollow', toFollowFunc);\r\nrouter.post('/myFollowing', myFollowingFunc);\r\nrouter.post('/deleteFollowing', deleteFollowingFunc);\r\nrouter.post('/follows', followsFunc);\r\nrouter.post('/myPosted', myPostedFunc);\r\nrouter.post('/myStar', myStarFunc);\r\nrouter.post('/myComments', myCommentsFunc);\r\nrouter.post('/changeMinePostStatus', changeMinePostStatusFunc);\r\nrouter.post('/ranking', rankingFunc);\r\nrouter.post('/getCityData', getCityDataFunc);\r\nrouter.post('/api', apiFunc);\r\nrouter.post('/map', mapFunc);\r\nrouter.get('/download', downloadFunc);\r\n\r\nexport default router;\r\n"]}